apiVersion: database.opzkit.io/v1alpha1
kind: Database
metadata:
  name: myapp-database
spec:
  # Database engine type
  engine: postgres

  # Name of the database to create
  databaseName: myapp_db

  # Option 1: Reference to Kubernetes Secret containing the admin connection string
  # Use either connectionStringSecretRef OR connectionStringAWSSecretRef, not both
  # Note: Created database credentials will ALWAYS be stored in AWS Secrets Manager
  connectionStringSecretRef:
    name: postgres-admin-connection
    key: connectionString  # optional, defaults to "connectionString"

  # Option 2: Reference to AWS Secrets Manager secret containing the admin connection string
  # Uncomment to use AWS Secrets Manager for the admin connection string
  # Note: Created database credentials will ALWAYS be stored in AWS Secrets Manager
  # connectionStringAWSSecretRef:
  #   secretName: rds/admin/postgres-connection
  #   key: connectionString  # optional, defaults to "connectionString"
  #   region: us-east-1      # optional, uses default AWS region if not specified

  # Username for the database user (optional, defaults to databaseName)
  # username: myapp_user

  # Secret name for storing the created credentials in AWS Secrets Manager (optional)
  # Defaults to rds/<engine>/<databaseName>
  # secretName: rds/postgres/myapp_db

  # Privileges to grant (optional, defaults to ["ALL"])
  #privileges:
  #  - ALL

  # Retain database/user on CR deletion (optional, defaults to true)
  retainOnDelete: false

  # AWS Secrets Manager configuration for storing created credentials (optional)
  # Created credentials are ALWAYS stored in AWS Secrets Manager
  awsSecretsManager:
    region: us-east-1      # required - AWS region for Secrets Manager
    description: "Database credentials for myapp"
    tags:
      Environment: production
      Application: myapp
