apiVersion: database.opzkit.io/v1alpha1
kind: Database
metadata:
  name: myapp-spring-boot
spec:
  engine: postgres
  databaseName: myapp_db
  connectionStringSecretRef:
    name: postgres-admin
  awsSecretsManager:
    region: us-east-1
    tags:
      Environment: production
      Application: myapp
  # Custom secret template for Spring Boot applications
  # The template uses Go template syntax and must produce valid JSON
  # Available variables: .DBHost, .DBPort, .DBName, .DBUsername, .DBPassword, .DatabaseURL, .Engine
  secretTemplate: |
    {
      "spring.datasource.url": "jdbc:postgresql://{{.DBHost}}:{{.DBPort}}/{{.DBName}}",
      "spring.datasource.username": "{{.DBUsername}}",
      "spring.datasource.password": "{{.DBPassword}}",
      "spring.datasource.driver-class-name": "org.postgresql.Driver"
    }
---
apiVersion: database.opzkit.io/v1alpha1
kind: Database
metadata:
  name: myapp-connection-string
spec:
  engine: mysql
  databaseName: myapp_mysql
  connectionStringSecretRef:
    name: mysql-admin
  awsSecretsManager:
    region: us-east-1
  # Simple connection string only template
  secretTemplate: |
    {
      "connectionString": "{{.DatabaseURL}}"
    }
---
apiVersion: database.opzkit.io/v1alpha1
kind: Database
metadata:
  name: myapp-env-vars
spec:
  engine: postgres
  databaseName: myapp_env
  connectionStringSecretRef:
    name: postgres-admin
  awsSecretsManager:
    region: us-east-1
  # Environment variable style naming
  secretTemplate: |
    {
      "DATABASE_HOST": "{{.DBHost}}",
      "DATABASE_PORT": "{{.DBPort}}",
      "DATABASE_NAME": "{{.DBName}}",
      "DATABASE_USER": "{{.DBUsername}}",
      "DATABASE_PASSWORD": "{{.DBPassword}}",
      "DATABASE_URL": "{{.DatabaseURL}}"
    }
